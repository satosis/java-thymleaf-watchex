<div th:include="/fragments/user/header"></div>
<div class="item" th:if="${product != null}">
    <title>[[${product.pro_name}]]</title>
    <div id="product">
        <div class="wrp">
            <div class="nameCate lsh">
                <a href="javascript://" class="name">[[${product.pro_name}]]</a>
            </div>
            <div class="detailPro">
                <div class="top">
                    <div class="left">
                        <div class="imgLarge">
                            <div class="img imgSmall">
                                <div class="wImage">
                                    <a href="javascript://" class="image">
                                        <img th:src="${product.pro_avatar}" th:alt="${product.pro_name}"/>
                                    </a>
                                </div>
                            </div>
                            @if(isset($image))
                            @foreach($image as $item)
                            <div class="img imgSmall">
                                <div class="wImage">
                                    <a href="javascript://" class="image">
                                        <img src="{{ pare_url_file($item->al_slug)}}"/>
                                    </a>
                                </div>
                            </div>
                            @endforeach
                            @endif
                        </div>
                    </div>
                    <div class="right">
                        <h1 style="position:relative">
                            <a href="javascript://" class="namePro">
                                [[${product.pro_name}]]
                            </a>
                            <i class="fa fa-eye"></i>&nbsp;[[${product.pro_view}]]
                            <a th:href="@{/product/favourite/{id}(id=${product.id})}"
                               th:class="${@commonConfigurations.getCurrentUser} ? 'js-add-favourite' : 'js-login js-add-favourite'">
                                <i th:class="${userFavourite} ?  'fa fa-heart red' : 'fa fa-heart-o'"></i>
                            </a>&nbsp;
                            <div class="favourite" style="position: absolute;bottom: 0;margin-left: 60px;">
                                [[${product.pro_favourite}]]
                            </div>
                        </h1>
                        <div class="price">
                            <div class="price1">
                                <span class="text">Giá niêm yết </span>
                                <span class="numb cc4161c">
                                    [[${@commonConfigurations.formatPrice(product.pro_price, product.pro_sale, 0)}]]đ
                                </span>
                                <span class="numb cc4161c"
                                      style="text-decoration: line-through;position: absolute;padding: 20px 150px;"
                                      th:if="${product.pro_sale}">
                                    [[${@commonConfigurations.formatPrice(product.pro_price, 0, 0)}]]đ
                                </span>
                            </div>
                        </div>
                        <h3 class="descript">
                            <div class="item">
                                <span class="text">Số lượng</span>
                                <span class="num">[[${product.pro_amount}]]</span>
                            </div>
                            <div class="item">
                                <span class="text">Độ chịu nước</span>
                                <span class="num">3ATM</span>
                            </div>
                            <div class="item">
                                <span class="text">Chất liệu mặt</span>
                                <span class="num">Kính sapphire</span>
                            </div>
                            <div class="item">
                                <span class="text">Năng lượng sử dụng</span>
                                <span class="num">Quartz/Pin </span>
                            </div>
                        </h3>
                        <div class="btnCart">
                            <a th:class="${@commonConfigurations.getCurrentUser} ? 'muangay' : 'js-login muangay'"
                               th:href="@{/cart/add/{id}(id=${product.id})}">
                                <span>Mua ngay</span>
                                <span>Giao hàng miễn phí - Thanh toán tại nhà</span>
                            </a>
                        </div>
                        <div th:if="${tags != null}">
                            <legend>Từ khóa</legend>
                            <i class="fa fa-tag"></i>
                            <p th:each="tag: ${tags}">
                                <a href="javascript:;" style="color: #00d4c0 !important;font-size:20px"
                                   th:ìf="${tag != null}"># [[${tag}]]</a>
                            </p>
                        </div>
                    </div>
                </div>
                <div class="bot">
                    <div class="detail">
                        <div class="otherPro slideRes">
                            <h3 class="title">Có thể bạn sẽ thích</h3>
                            <div class="group"
                                 th:include="/components/product/item" th:with="products=${productSuggest}">
                            </div>
                        </div>
                        <div class="dn dbTablet">
                            <div class="thongsokythuat">
                                <div class="titleR">Thông số kỹ thuật</div>
                                <div class="group">
                                    <div class="item">
                                        <p class="text1">Đường kính mặt</p>
                                        <p class="text2"><a href="javarscript://">27mm</a></p>
                                    </div>
                                    <div class="item">
                                        <p class="text1">Chống nước</p>
                                        <p class="text2"><a href="javarscript://">3ATM</a></p>
                                    </div>
                                    <div class="item">
                                        <p class="text1">Chất liệu mặt</p>
                                        <p class="text2">Kính sapphire</p>
                                    </div>
                                    <div class="item">
                                        <p class="text1">Năng lượng sử dụng</p>
                                        <p class="text2">Quartz/Pin </p>
                                    </div>
                                    <div class="item">
                                        <p class="text1">Size dây</p>
                                        <p class="text2">12mm</p>
                                    </div>
                                    <div class="item">
                                        <p class="text1">Chất liệu dây</p>
                                        <p class="text2">Hợp kim mạ PVD</p>
                                    </div>
                                    <div class="item">
                                        <p class="text1">Chất liệu vỏ</p>
                                        <p class="text2">Hợp kim mạ PVD , đính đá swarovsky</p>
                                    </div>
                                    <div class="item">
                                        <p class="text1">Kiểu dáng</p>
                                        <p class="text2">Nữ</p>
                                    </div>
                                    <div class="item">
                                        <p class="text1">Xuất xứ</p>
                                        <p class="text2">China</p>
                                    </div>
                                    <div class="item">
                                        <p class="text1">Chế độ bảo hành</p>
                                        <p class="text2">Bảo hành quốc tế <b>10</b> năm</p>
                                    </div>
                                </div>
                            </div>

                            <div class="box_policy">
                                <div class="fs14">
                                    <img class="mr-1" src="/view/css/icon/box.png" height="17">
                                    Sản phẩm Fullbox:
                                </div>
                                <div style="display: flex;padding-top: 5px;font-style: italic;">
                                    <a class="name" href="javascript://"> <span>
                              Hộp đựng, thẻ bảo hành quốc tế, thẻ khách hàng thân thiết, khăn lau (đối với kính mắt)</span>
                                    </a>
                                </div>
                                <div class="pt10 fs14">
                                    <img class="mr-1" src="/view/css/icon/bh10.png" height="17">
                                    <a class="name" href="javascript:;">
                                        Chế độ bảo hành 10 năm <span>(Xem chi tiết)</span>
                                    </a>
                                </div>
                                <div class="pt10 fsfs1416">
                                    <img class="mr-1" src="/view/css/icon/doi.png" height="17">
                                    <a class="name" href="javascript://">
                                        30 ngày đổi sản phẩm miễn phí.
                                    </a>
                                </div>
                                <div class="pt10 fs14">
                                    <img class="mr-1" src="/view/css/icon/ship.png" height="17">
                                    <a class="name" href="javascript://">
                                        Giao miễn phí, nhận hàng kiểm tra trước khi thanh toán
                                    </a>
                                </div>
                                <div class="pt10 fs14">
                                    <img class="mr-1" src="/view/css/icon/vat.png" height="17">
                                    <a class="name" href="javascript://">
                                        Chính hãng 100% - xuất hoá đơn VAT
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="splienquan">
                            <div class="item">
                                <div class="left">
                                    <div class="wImage">
                                        <a href="javascript://" class="image">
                                            <img th:src="${product.pro_avatar}" th:alt="${product.pro_name}"
                                                 class="lazy"/>
                                        </a>
                                    </div>
                                    <div class="info">
                                        <a href="javascript://" class="name">
                                            [[${product.pro_name}]]
                                        </a>
                                        <p class="price">
                                            [[${@commonConfigurations.formatPrice(product.pro_price, product.pro_sale,
                                            0)}]]đ
                                        </p>
                                    </div>
                                </div>
                                <div class="lstBtn">
                                    <a th:href="@{/cart/add/{id}(id=${product.id})}"
                                       th:class="${@commonConfigurations.getCurrentUser} ? 'buttn muangay' : 'js-login buttn muangay'">Mua
                                        ngay</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="detailRight">
                        <div class="dntablet">
                            <div class="thongsokythuat">
                                <div class="titleR">Thông số kỹ thuật</div>
                                <div class="group">
                                    <div class="item">
                                        <p class="text1">Đường kính mặt</p>
                                        <p class="text2"><a href="javarscript://">27mm</a></p>
                                    </div>
                                    <div class="item">
                                        <p class="text1">Chống nước</p>
                                        <p class="text2"><a href="javarscript://">3ATM</a></p>
                                    </div>
                                    <div class="item">
                                        <p class="text1">Chất liệu mặt</p>
                                        <p class="text2">Kính sapphire</p>
                                    </div>
                                    <div class="item">
                                        <p class="text1">Năng lượng sử dụng</p>
                                        <p class="text2">Quartz/Pin </p>
                                    </div>
                                    <div class="item">
                                        <p class="text1">Size dây</p>
                                        <p class="text2">12mm</p>
                                    </div>
                                    <div class="item">
                                        <p class="text1">Chất liệu dây</p>
                                        <p class="text2">Hợp kim mạ PVD</p>
                                    </div>
                                    <div class="item">
                                        <p class="text1">Chất liệu vỏ</p>
                                        <p class="text2">Hợp kim mạ PVD , đính đá swarovsky</p>
                                    </div>
                                    <div class="item">
                                        <p class="text1">Kiểu dáng</p>
                                        <p class="text2">Nữ</p>
                                    </div>
                                    <div class="item">
                                        <p class="text1">Xuất xứ</p>
                                        <p class="text2">China</p>
                                    </div>
                                    <div class="item">
                                        <p class="text1">Chế độ bảo hành</p>
                                        <p class="text2">Bảo hành quốc tế <b>10</b> năm</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="block-ud2glzu2WR1" class="pdp-block fixed-width-full  block-margin-top background-2">
        <div id="module_product_review" class="pdp-block module">
            <div class="pdp-mod-review">
                <div class="mod-title">
                    <h2 class="pdp-mod-section-title outer-title">Đánh giá và nhận xét của [[${product.pro_name}]]</h2>
                </div>
                <div class="mod-rating">
                    <div class="content">
                        <div class="left">
                            <div class="summary">
                                <div class="score">
                                    <span class="score-average">
                                        [[${@commonConfigurations.formatPrice(product.star, 0, 2)}]]
                                    </span>
                                    <span class="score-max">/5</span></div>
                                <div class="average">
                                    <div class="container-star " style="width: 166.25px; height: 33.25px;"
                                         th:if="${product.star == 0}">
                                        <img class="star"
                                             src="//laz-img-cdn.alicdn.com/tfs/TB18ZvEgfDH8KJjy1XcXXcpdXXa-64-64.png"
                                             style="width: 33.25px; height: 33.25px;">
                                        <img class="star"
                                             src="//laz-img-cdn.alicdn.com/tfs/TB18ZvEgfDH8KJjy1XcXXcpdXXa-64-64.png"
                                             style="width: 33.25px; height: 33.25px;">
                                        <img class="star"
                                             src="//laz-img-cdn.alicdn.com/tfs/TB18ZvEgfDH8KJjy1XcXXcpdXXa-64-64.png"
                                             style="width: 33.25px; height: 33.25px;">
                                        <img class="star"
                                             src="//laz-img-cdn.alicdn.com/tfs/TB18ZvEgfDH8KJjy1XcXXcpdXXa-64-64.png"
                                             style="width: 33.25px; height: 33.25px;">
                                        <img class="star"
                                             src="//laz-img-cdn.alicdn.com/tfs/TB18ZvEgfDH8KJjy1XcXXcpdXXa-64-64.png"
                                             style="width: 33.25px; height: 33.25px;">
                                    </div>
                                    <div class="container-star " style="width: 166.25px; height: 33.25px;" th:else>
                                        <img class="star"
                                             src="//laz-img-cdn.alicdn.com/tfs/TB19ZvEgfDH8KJjy1XcXXcpdXXa-64-64.png"
                                             style="width: 33.25px; height: 33.25px;"
                                             th:each="i : ${#numbers.sequence(1, product.star)}">

                                        <img class="star"
                                             src="//laz-img-cdn.alicdn.com/tfs/TB18ZvEgfDH8KJjy1XcXXcpdXXa-64-64.png"
                                             style="width: 33.25px; height: 33.25px;" th:if="${product.star < 5}"
                                             th:each="i : ${#numbers.sequence(product.star + 1, 5)}">
                                    </div>
                                </div>
                            </div>
                            <div class="count"> [[${product.pro_review_star}]] đánh giá</div>
                        </div>
                        <div class="detail" th:each="star: ${#numbers.sequence(1, 5)}">
                            <ul>
                                <li>
                                    <div class="container-star progress-title"
                                         style="width: 80px; height: 16px;">
                                        <img class="star"
                                             src="//laz-img-cdn.alicdn.com/tfs/TB19ZvEgfDH8KJjy1XcXXcpdXXa-64-64.png"
                                             th:each="i: ${#numbers.sequence(1, star)}" alt="star">
                                        <img class="star"
                                             src="//laz-img-cdn.alicdn.com/tfs/TB18ZvEgfDH8KJjy1XcXXcpdXXa-64-64.png"
                                             th:each="i: ${#numbers.sequence(star + 1, 5)}" alt="star"
                                             th:if="${star < 5 }">
                                    </div>
                                    <span class="progress-wrap">
                                          <div class="pdp-review-progress">
                                             <div class="bar bg"></div>
                                             <div class="bar fg" style="width: 33%"></div>
                                          </div>
                                       </span>
                                    <span class="percent" th:if="${ratings != null}" th:text="${product.ratings}"></span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div>
            </div>
            <div class="review_list">
                <div class="mod-reviews" th:each="rating: ${listRating}">
                    <div class="item">
                        <div class="top">
                            <div class="container-star starCtn left" style="width: 83.125px; height: 16.625px;">
                                <img th:each="i : ${#numbers.sequence(1, rating.r_number)}" class="star"
                                     src="//laz-img-cdn.alicdn.com/tfs/TB19ZvEgfDH8KJjy1XcXXcpdXXa-64-64.png">
                                <img th:each="i : ${#numbers.sequence(rating.r_number + 1, 5)}"
                                     th:if="${rating.r_number < 5 }" class="star"
                                     src="//laz-img-cdn.alicdn.com/tfs/TB18ZvEgfDH8KJjy1XcXXcpdXXa-64-64.png">
                            </div>
                            <span class="title right">[[${rating.createdAt}]]</span>
                        </div>
                        <div class="middle"><span>bởi [[${rating.r_user_id.name}]]</span></div>
                        <div class="item-content">
                            <div class="content">[[${rating.r_content}]]</div>
                        </div>
                    </div>
                </div>

            </div>

            <div id="block-review" th:if="${#request.userPrincipal}">
                <form th:action="@{/product/rating/{id}(id=${product.id})}" class="form-question" method="post">
                    <div class="item">
                        <br><br>
                        <div id="module_product_qna" class="pdp-block module">
                            <div class="mod-title">
                                <div class="pdp-mod-section-title outer-title">Phản hồi của bạn về sản phẩm
                                    này
                                </div>
                                <br><br>
                                <div class="top">
                                    <div class="container-star starCtn left" id="ratings"
                                         style="width: 223.125px; height: 16.625px;">
                                        <i class="fa fa-star opacity cursor" style="zoom:2"
                                           th:each="i : ${#numbers.sequence(1, 5)}"
                                           th:data-i="${i}"></i>
                                        <span id="review_text"></span>
                                        <input type="hidden" id="review_value" name="review" value="5">
                                    </div>
                                </div>
                                <div class="pdp-mod-qna">
                                    <div class="qna-ask-box-container">
                                        <div class="qna-ask-box folded">
                                                <span class="next-input next-input-single next-input-medium qna-ask-input"><input
                                                        type="text" placeholder="Viết câu hỏi của bạn ở đây"
                                                        value="" name="content" maxlength="300"
                                                        height="100%"></span>
                                            <button type="submit"
                                                    class=" cursor next-btn next-btn-primary next-btn-medium qna-ask-btn js-process-view">
                                                ĐẶT CÂU HỎI
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                <div class="qna-section-title">Câu hỏi của tôi</div>
                <div th:if="${myRating == null}">
                    <span class="lazada lazada-noReview lazada-icon qna-empty-icon"></span>
                    <div class="qna-empty-text">Chưa có câu hỏi cho sản phẩm này.</div>
                    <div class="qna-empty-text">Đặt câu hỏi cho nhà bán hàng và câu trả lời sẽ được hiển thị tại đây
                    </div>
                </div>
                <ul class="qna-list">
                    <div class="review_list_personal"></div>
                    <li class="qna-item" th:each="rating: ${myRating}">
                        <div class="qna-item-group">
                            <div class="middle"><span>[[${rating.r_user_id.name}]]</span></div>
                            <div class="top">
                                <div class="container-star starCtn left" style="width: 83.125px; height: 16.625px;">
                                    <img th:each="i : ${#numbers.sequence(1, rating.r_number)}" class="star" src="//laz-img-cdn.alicdn.com/tfs/TB19ZvEgfDH8KJjy1XcXXcpdXXa-64-64.png">
                                    <img th:each="i : ${#numbers.sequence(rating.r_number, 5)}"
                                         th:if="${rating.r_number < 5 }" class="star" src="//laz-img-cdn.alicdn.com/tfs/TB18ZvEgfDH8KJjy1XcXXcpdXXa-64-64.png">
                                </div>
                                <span class="title right">[[${rating.createdAt}]]</span>
                            </div>
                            <div class="qna-content">[[${rating.r_content}]]</div>
                            <div class="qna-meta"></div>
                        </div>
                    </li>
                    <br/><br/><br/>
                </ul>
            </div>
        </div>
    </div>
</div>
</div>
</div>
</div>
<div id="SupInfo">
    <div class="wrp">
        <div class="left">
            <div class="item">
                <p class="head">Hotline</p>
                <a href="tel:18006005" class="tel">
                    <span class="icon"><i class="fa fa-phone"></i></span>
                    <span class="text">1800.6005</span>
                </a>
            </div>
            <div class="item">
                <p class="head">Gọi đặt hàng</p>
                <a href="tel:0985681189" class="tel">
                    <span class="icon"><i class="fa fa-phone"></i></span>
                    <span class="text">098.568.1189</span>
                </a>
            </div>
        </div>
        <div class="right">
            <div class="mail">
                <p class="fs17 ttu mb10">Đăng ký nhận thông tin mới</p>
                <div id="frmMail">
                    <input type="text" value="" placeholder="Nhập email của bạn tại đây"/>
                    <a href="javascript://" class="btnRegis">Đăng ký</a>
                </div>
            </div>
            <div class="social">
                <p class="fs17 ttu mb10">Kết nối mạng xã hội</p>
                <ul>
                    <li><a rel="nofollow" href="javascript:" target="_blank"><i class="fa fa-facebook-f"></i></a></li>
                    <li><a rel="nofollow" href="javascript:" target="_blank"><i class="fa fa-instagram"></i></a></li>
                    <li><a rel="nofollow" href="javascript:" target="_blank"><i class="fa fa-youtube"></i></a></li>
                </ul>
            </div>
        </div>
    </div>
</div>
<div th:include="/fragments/user/footer"></div>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

<script>
    $(function () {
        $('.js-add-favourite').click(function (event) {
            event.preventDefault();
            let $this = $(this);
            let URL = $this.attr('href');
            if (URL) {
                $.ajax({
                    headers: {
                        'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                    },
                    method: "POST",
                    url: URL
                }).done(function (result) {
                    if (result.status == 1) {
                        $('.js-add-favourite i').removeClass('fa-heart-o');
                        $('.js-add-favourite i').addClass('fa-heart');
                        $('.js-add-favourite i').addClass('red');
                    } else if (result.status == 2) {
                        $('.js-add-favourite i').removeClass('fa-heart');
                        $('.js-add-favourite i').removeClass('red');
                        $('.js-add-favourite i').addClass('fa-heart-o');

                    }
                    $this.parents('h1').find('.favourite').text(result.count);

                })
            }
        });

        let $item = $("#ratings i");
        let arrTextRating = {
            1: "Rất tồi tệ",
            2: "Tồi tệ",
            3: "Tốt",
            4: "Xuất sắc",
            5: "Tuyệt vời"
        };
        $item.mouseover(function () {
            let $this = $(this);
            let $i = $this.attr('data-i');
            $("#review_value").val($i);
            $item.removeClass('r-active');
            $item.each(function (key, value) {
                if (key + 1 <= $i) {
                    $(this).addClass('r-active');
                }
            })
            $("#review_text").addClass('review_text');
            $("#review_text").text(arrTextRating[$i]);
        });
        $(".js-process-view").click(function (event) {
            event.preventDefault();
            let URL = $(this).parents('form').attr('action');
            $.ajax({
                method: "POST",
                headers: {
                    'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                },
                url: URL,
                data: $('.form-question').serialize()
            }).done(function (result) {
                toastr.success("Thành công")
                window.location.reload()
            })
        });


        $("body").on('click', '.pagination a', function (event) {
            event.preventDefault();

            $('li').removeClass('active');
            $(this).parent('li').addClass('active');
            let URL = $(this).attr('href');
            var myurl = URL;
            var page = URL.split('page=')[1];

            getRatingList(page);
        });

        function getRatingList(page) {
            $.ajax({
                type: "GET",
                url: '?page=' + page
            })
                .success(function (results) {
                    $(".review_list_personal").html(results.html);
                });
        }
    })
</script>
